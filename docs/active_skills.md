# Active Skills & Cool-downs

This system introduces active abilities for both the player and enemies, adding a layer of tactical depth to combat. Each skill has a stamina cost and a cool-down period, requiring strategic use of resources. This moves beyond simple attacks, allowing for special moves like stuns or self-buffs.

## Data Model

The core of the system is the `Ability` base class and new `Entity` component fields.

*   **`Ability` base class** ([`src/abilities/base.py`](src/abilities/base.py)):
    *   `name`: The display name of the ability (e.g., "Shield Bash").
    *   `stamina_cost`: How much stamina is required to use the skill.
    *   `base_cooldown`: The number of turns the skill is unusable after activation.

*   **`Entity` updates** ([`src/entities/base.py`](src/entities/base.py)):
    *   `cooldowns`: A dictionary tracking the remaining cool-down turns for each ability, like `{'shield_bash': 3}`.
    *   `tick_cooldowns()`: A method called each turn to reduce all active cool-downs by one.
    *   `ability_ready(ability)`: A method to check if a given ability can be used (i.e., its cool-down is over and the entity has enough stamina).

## Player & Enemy Usage

Both player and enemies can be assigned abilities.

*   **Player Abilities** ([`src/abilities/player_abilities.py`](src/abilities/player_abilities.py)):
    *   `ShieldBashAbility`: Bound to the **Q** key. Costs stamina, has a 3-turn cool-down, and deals damage while also stunning the target for one turn.
    *   `AdrenalineRushAbility`: Bound to the **W** key. Costs stamina, has a 4-turn cool-down, and grants the player +2 stamina.

*   **Enemy Abilities**:
    *   New enemy abilities are defined in [`src/abilities/enemy_abilities.py`](src/abilities/enemy_abilities.py).
    *   Enemies are instantiated with a list of abilities they can use.

## Battle-Loop Integration

Skills are integrated directly into the main battle flow in [`src/states/battle.py`](src/states/battle.py).

*   At the start of an entity's turn (both player and enemy), its `tick_cooldowns()` method is called.
*   The enemy AI will check if any of its skills are ready and if using one would be advantageous (e.g., stunning the player). If so, it will prioritize using a skill over a standard attack.

## Input & UI

The UI and input handling have been updated to support active skills.

*   **Input**: Keybinds **Q**, **W**, **E**, and **R** are mapped to GameEvents `"skill_q"`, `"skill_w"`, `"skill_e"`, and `"skill_r"` respectively in [`src/core/events.py`](src/core/events.py).
*   **UI**: The battle screen's skill labels are generated by the `format_skill_label()` helper in [`src/core/ui.py`](src/core/ui.py). This produces dynamic labels like `Q Shield Bash (2)` when on cool-down, or `Q Shield Bash (READY)` when available.

## Extending the System

Adding a new skill is straightforward:

1.  Define a new `Ability` subclass in [`src/abilities/player_abilities.py`](src/abilities/player_abilities.py) or [`src/abilities/enemy_abilities.py`](src/abilities/enemy_abilities.py).
2.  Implement the `use()` method, which contains the skill's logic.
3.  Set the `name`, `stamina_cost`, and `base_cooldown`.
4.  If it's a player skill, add it to the `Player`'s `abilities` dict in [`src/entities/player.py`](src/entities/player.py).
5.  Assign a keybind in [`src/entities/player.py`](src/entities/player.py) to link the input event to the ability.
6.  If it's an enemy skill, pass an instance of it to the `Enemy` constructor in [`src/entities/enemy.py`](src/entities/enemy.py).
7.  Optionally, update the `choose_action()` AI logic in [`src/entities/enemy.py`](src/entities/enemy.py) if the skill requires special targeting or conditions.
8.  Add tests for the new skill's logic and side effects.

## Testing

The skill system is covered by unit and integration tests:
*   [`tests/test_skills.py`](tests/test_skills.py): Verifies ability logic, stamina costs, and cool-down mechanics.
*   [`tests/test_ui_skill_labels.py`](tests/test_ui_skill_labels.py): Ensures the UI labels for skills display correctly in all states (ready, on cool-down, not enough stamina).